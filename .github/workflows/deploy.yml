name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      # 1. –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–¥
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v3

      # 2. –°–æ–∑–¥–∞–µ–º —á–∏—Å—Ç—É—é –ø–∞–ø–∫—É –¥–ª—è —Å–±–æ—Ä–∫–∏
      - name: Create Build Directory
        run: mkdir build

      # 3. –í–Ω–µ–¥—Ä—è–µ–º —Å–µ–∫—Ä–µ—Ç –∏ –ø–æ–º–µ—â–∞–µ–º –≥–æ—Ç–æ–≤—ã–π —Ñ–∞–π–ª –≤ –ø–∞–ø–∫—É 'build'
      - name: Replace API Key and move to build folder ü§´
        run: |
          # –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —á–∏—Ç–∞–µ—Ç –≤–∞—à index.html, –∑–∞–º–µ–Ω—è–µ—Ç –∫–ª—é—á –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ build/index.html
          sed 's|%%GEMINI_API_KEY%%|${{ secrets.GEMINI_API_KEY }}|g' index.html > build/index.html
        
      # 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á –≤ –Ω–æ–≤–æ–º —Ñ–∞–π–ª–µ –≤–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ 'build'
      - name: Verify Key Replacement in build/index.html (DEBUG) ‚úÖ
        run: |
          echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ –∫–ª—é—á –≤—Å—Ç–∞–≤–ª–µ–Ω –≤ build/index.html:"
          grep 'const apiKey =' build/index.html
      
      # 5. –ü—É–±–ª–∏–∫—É–µ–º –¢–û–õ–¨–ö–û —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ 'build'
      - name: Deploy üöÄ
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          # –í–ê–ñ–ù–û: –ú—ã —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–∞–ø–∫—É 'build'
          folder: build
          # –≠—Ç–∞ –æ–ø—Ü–∏—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
          clean: true 

