name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      # 1. –ö–æ–ø–∏—Ä—É–µ–º –≤–∞—à –∫–æ–¥
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v3

      # 2. –°–æ–∑–¥–∞–µ–º —á–∏—Å—Ç—É—é –ø–∞–ø–∫—É –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
      - name: Create Build Directory
        run: mkdir build

      # 3. –ö–æ–ø–∏—Ä—É–µ–º HTML, –≤–Ω–µ–¥—Ä—è–µ–º –∫–ª—é—á –∏ –∫–ª–∞–¥–µ–º –≤ –ø–∞–ø–∫—É build
      - name: Replace API Key and place in build folder ü§´
        run: |
          # –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —á–∏—Ç–∞–µ—Ç –≤–∞—à index.html, –∑–∞–º–µ–Ω—è–µ—Ç –∫–ª—é—á –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ build/index.html
          sed 's|%%GEMINI_API_KEY%%|${{ secrets.GEMINI_API_KEY }}|g' index.html > build/index.html
        
      # 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª—é—á –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤—Å—Ç–∞–≤–ª–µ–Ω –≤ —Ñ–∞–π–ª –≤–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ build
      - name: Verify Key Replacement in build/index.html (DEBUG) ‚úÖ
        run: |
          echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á –≤ –≥–æ—Ç–æ–≤–æ–º —Ñ–∞–π–ª–µ build/index.html:"
          grep 'const apiKey' build/index.html

      # 5. –ü—É–±–ª–∏–∫—É–µ–º –¢–û–õ–¨–ö–û —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ build
      - name: Deploy üöÄ
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: build # –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø–∞–ø–∫—É 'build'
          clean: true    # –≠—Ç–∞ –æ–ø—Ü–∏—è —É–¥–∞–ª–∏—Ç –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã —Å —Å–µ—Ä–≤–µ—Ä–∞

