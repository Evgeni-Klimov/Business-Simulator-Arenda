name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main # –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ç–æ –≤–∞—à–∞ –æ—Å–Ω–æ–≤–Ω–∞—è –≤–µ—Ç–∫–∞

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write # –ü—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –æ—Å—Ç–∞—é—Ç—Å—è

    steps:
      # 1. –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–¥ –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v3

      # 2. –®–ê–ì –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
      - name: List files in the repository
        run: ls -R

      # 3. –í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞ –≤ –Ω–æ–≤—ã–π —Ñ–∞–π–ª index.html
      - name: Replace API Key and create index.html ü§´
        run: |
          # –í–ù–ò–ú–ê–ù–ò–ï: –ï—Å–ª–∏ –≤–∞—à HTML-—Ñ–∞–π–ª –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω–∞—á–µ, –∏–∑–º–µ–Ω–∏—Ç–µ –∏–º—è –≤ —Å—Ç—Ä–æ–∫–µ –Ω–∏–∂–µ.
          # –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —á–∏—Ç–∞–µ—Ç –≤–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π HTML, –∑–∞–º–µ–Ω—è–µ—Ç –∫–ª—é—á –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –Ω–æ–≤—ã–π —Ñ–∞–π–ª 'index.html'
          sed 's|%%GEMINI_API_KEY%%|${{ secrets.GEMINI_API_KEY }}|g' tool_rental_business_simulator_v6.html > index.html
        
      # 4. –ü—Ä–æ–≤–µ—Ä–∫–∞
      - name: Verify Key Replacement in index.html (DEBUG) ‚úÖ
        run: |
          echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ –∫–ª—é—á –≤—Å—Ç–∞–≤–ª–µ–Ω –≤ index.html:"
          grep 'const apiKey =' index.html
      
      # 5. –ü—É–±–ª–∏–∫–∞—Ü–∏—è
      - name: Deploy üöÄ
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: . # –ü—É–±–ª–∏–∫—É–µ–º –≤—Å–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ, –≤–∫–ª—é—á–∞—è –Ω–æ–≤—ã–π index.html

