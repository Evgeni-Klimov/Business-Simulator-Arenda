name: Deploy to GitHub Pages

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –≤–µ—Ç–∫–∏ (main)
on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–±–æ—Ä–∫–∏
    runs-on: ubuntu-latest
    steps:
      # 1. –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–¥ –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v3

      # 2. –ì–ª–∞–≤–Ω—ã–π —à–∞–≥: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞
      - name: Replace API Key in HTML ü§´
        run: |
          # –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –Ω–∞—Ö–æ–¥–∏—Ç –≤ –≤–∞—à–µ–º HTML —Ñ–∞–π–ª–µ –º–µ—Ç–∫—É %%GEMINI_API_KEY%%
          # –∏ –∑–∞–º–µ–Ω—è–µ—Ç –µ–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –∫–ª—é—á, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –¥–æ–±–∞–≤–∏–ª–∏ –≤ —Å–µ–∫—Ä–µ—Ç—ã.
          # –í–ù–ò–ú–ê–ù–ò–ï: –ï—Å–ª–∏ –≤–∞—à HTML-—Ñ–∞–π–ª –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω–∞—á–µ, –∏–∑–º–µ–Ω–∏—Ç–µ –∏–º—è –≤ —Å—Ç—Ä–æ–∫–µ –Ω–∏–∂–µ.
          awk -v key="${{ secrets.GEMINI_API_KEY }}" '{gsub("%%GEMINI_API_KEY%%", key)}1' tool_rental_business_simulator_v6.html > index.html

      # 3. –®–∞–≥ –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏ (–≤—ã —Å–º–æ–∂–µ—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ª–æ–≥–∞—Ö)
      - name: Verify Key Replacement (DEBUG) ‚úÖ
        run: |
          echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ –∫–ª—é—á –≤—Å—Ç–∞–≤–ª–µ–Ω –≤ index.html:"
          # –ò—â–µ–º —Å—Ç—Ä–æ–∫—É —Å –∫–ª—é—á–æ–º –∏ –≤—ã–≤–æ–¥–∏–º –≤ –ª–æ–≥ –µ–µ –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.
          grep 'const apiKey =' index.html | awk -F'"' '{print $1 "\"" substr($2, 1, 4) "..." substr($2, length($2)-3) "\""}'
      
      # 4. –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≥–æ—Ç–æ–≤–æ–≥–æ —Å–∞–π—Ç–∞ –Ω–∞ GitHub Pages
      - name: Deploy üöÄ
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages # –ü—É–±–ª–∏–∫—É–µ–º –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –≤–µ—Ç–∫—É gh-pages
          folder: .       # –ü—É–±–ª–∏–∫—É–µ–º –≤—Å–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏

